<!DOCTYPE html>
<html>
  <head>
  <title>
      
          CSS动画 - 董帅志的小窝
      
  </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="董帅志" />
  <link rel="shortcut icon" type="image/x-icon" href="https://github.com/PerfectVirgo/img/favicon.ico">

  
  
  
  
  
  <link rel="stylesheet" href="https://github.com/PerfectVirgo/style.min.6f642c5866835106e8a19b94463576436c99be9e41a8714ab3df3daa95f6bf90.css" integrity="sha256-b2QsWGaDUQbooZuURjV2Q2yZvp5BqHFKs989qpX2v5A=">
  
  
  
  <link rel="stylesheet" href="https://github.com/PerfectVirgo/style-dark.min.0a647fb6c07e04b77b54fa0515d0a683d39ecdb251dba960fe1f966f7ff36fc2.css" media="(prefers-color-scheme: dark)" integrity="sha256-CmR/tsB&#43;BLd7VPoFFdCmg9OezbJR26lg/h&#43;Wb3/zb8I=">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

  
  

  <meta property="og:title" content="CSS动画" />
<meta property="og:description" content="1. 动画 定义 由许多静止的画面（帧） 以一定的速度（如每秒30张）连续播放时 肉眼因视觉残象产生错觉 而误以为是活动的画面 概念 帧：每个静止的画面都叫做" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://github.com/PerfectVirgo/blog/09-css%E5%8A%A8%E7%94%BB/" />
<meta property="article:published_time" content="2020-04-05T20:57:30+08:00" />
<meta property="article:modified_time" content="2020-04-05T20:57:30+08:00" />
<meta itemprop="name" content="CSS动画">
<meta itemprop="description" content="1. 动画 定义 由许多静止的画面（帧） 以一定的速度（如每秒30张）连续播放时 肉眼因视觉残象产生错觉 而误以为是活动的画面 概念 帧：每个静止的画面都叫做">
<meta itemprop="datePublished" content="2020-04-05T20:57:30&#43;08:00" />
<meta itemprop="dateModified" content="2020-04-05T20:57:30&#43;08:00" />
<meta itemprop="wordCount" content="1560">



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:image" content="https://github.com/PerfectVirgo//img/avatar.jpg"/>
<meta name="twitter:title" content="CSS动画"/>
<meta name="twitter:description" content="1. 动画 定义 由许多静止的画面（帧） 以一定的速度（如每秒30张）连续播放时 肉眼因视觉残象产生错觉 而误以为是活动的画面 概念 帧：每个静止的画面都叫做"/>

  <!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
  <![endif]-->

  <!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
  <![endif]-->

  </head>

  <body>
    
  <h1>CSS动画</h1>
  <header>
  
  <div class="avatar">
    <img class="avatarMask" src="https://github.com/PerfectVirgo//img/avatar.jpg" alt="">
    <a href="https://github.com/PerfectVirgo/"><img class="avatar-border" src="https://github.com/PerfectVirgo//img/avatar-border.svg" alt=""></a>
  </div>
  
  <h2><a class="author" href="https://github.com/PerfectVirgo/">董帅志</a></h2>
</header>

  
  
  
  <p class="date">April 5, 2020</p>
  
  
  
  
  <div id="contentBody">
    <h2 id="1-动画">1. 动画</h2>
<ul>
<li>
<p>定义</p>
<p>由许多静止的画面（帧）</p>
<p>以一定的速度（如每秒30张）连续播放时</p>
<p>肉眼因视觉残象产生错觉</p>
<p>而误以为是活动的画面</p>
</li>
<li>
<p>概念</p>
<p>帧：每个静止的画面都叫做帧</p>
<p>播放速度：每秒 24 帧（影视） 或者每秒 30 帧（游戏）</p>
</li>
<li>
<p>一个最简单的例子</p>
<ul>
<li>
<p>将 div 从左往右移动</p>
<p><a href="http://js.jirengu.com/bagow/1/edit?html,js,output">代码</a></p>
</li>
<li>
<p>原理</p>
<p>每过一段时间（用 setInterval 做到）</p>
<p>将 div 移动一小段距离</p>
<p>直到移动到目标地点</p>
</li>
<li>
<p>注意性能</p>
<p>绿色表示重新绘制（repaint）了</p>
<p>CSS 渲染过程依次包含布局、绘制、合成</p>
<p>其中布局和绘制有可能被省略</p>
</li>
</ul>
</li>
<li>
<p>前端高手不用 left 做动画</p>
<ul>
<li>
<p>用 transform（变形）</p>
<p><a href="http://js.jirengu.com/lojiz/1/edit?html,css,js,output">代码</a></p>
</li>
<li>
<p>原理</p>
<p>transform: translateX(0 =&gt; 300px)</p>
<p>直接修改会被合成，需要等一会修改</p>
<p>transition 过渡属性可以自动脑补中间帧</p>
</li>
<li>
<p>注意性能</p>
<p>并没有 relayout 以及 repaint（重新绘制）</p>
<p>比改 left 性能好</p>
</li>
</ul>
</li>
</ul>
<h2 id="2-浏览器渲染原理">2. 浏览器渲染原理</h2>
<ul>
<li>
<p>参考文章</p>
<ul>
<li>
<p>Google 团队写的文章（右上角中文）</p>
<p><a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction">渲染树构建、布局及绘制</a></p>
<p><a href="https://developers.google.com/web/fundamentals/performance/rendering/">渲染性能</a></p>
<p><a href="https://developers.google.com/web/fundamentals/performance/rendering/stick-to-compositor-only-properties-and-manage-layer-count">使用 transform 来实现动画</a></p>
</li>
<li>
<p>查看 CSS 各属性触发什么</p>
<p><a href="https://csstriggers.com/">CSSTriggers.com</a></p>
</li>
</ul>
</li>
<li>
<p>浏览器渲染过程</p>
<p>根据 HTML 构建 HTML 树（DOM）</p>
<p>根据 CSS 构建 CSS 树（CSSOM）</p>
<p>将两棵树合并成一颗渲染树（render tree）</p>
<p>Layout 布局（文档流、盒模型、计算大小和位置）</p>
<p>Paint 绘制（把边框颜色、文字颜色、阴影等画出来）</p>
<p>Composite 合成（根据层叠关系展示画面）</p>
<p><img src="https://i.loli.net/2020/04/05/E7gzLpFoGBPJa1T.png" alt="渲染树.png"></p>
</li>
<li>
<p>如何更新样式</p>
<ul>
<li>
<p>一般我们用 JS 来更新样式</p>
<p>比如 <code>div.style.background='red'</code></p>
<p>比如 <code>div.style.display='none'</code></p>
<p>比如 <code>div.classList.add=('red')</code></p>
<p>比如 <code>div.remove()</code> 直接删掉节点</p>
</li>
<li>
<p>那么这些方法有什么不同吗</p>
<p>有三种不同的渲染方式</p>
<p><img src="https://i.loli.net/2020/04/05/mzclvKx7QUefYMX.png" alt="更新方式.png"></p>
</li>
</ul>
</li>
<li>
<p>三种更新方式</p>
<ul>
<li>
<p>第一种，全走</p>
<p><a href="http://js.jirengu.com/jagel/1/edit?html,css,js,output">div.remove()</a> 会触发当前消失，其他元素 relayout</p>
</li>
<li>
<p>第二种，跳过 layout</p>
<p><a href="http://js.jirengu.com/jidam/1/edit?html,css,js,output">改变背景颜色</a>，直接 repaint + composite</p>
</li>
<li>
<p>第三种，跳过 layout 和 paint</p>
<p><a href="http://js.jirengu.com/wusew/1">改变 transform</a>，只需 composite</p>
<p>注意必须全屏查看效果，在 iframe 里看有问题</p>
</li>
</ul>
</li>
<li>
<p>CSS 动画优化</p>
<ul>
<li>
<p>没什么技术含量</p>
<p>答案都在<a href="https://developers.google.com/web/fundamentals/performance/rendering/stick-to-compositor-only-properties-and-manage-layer-count">Google 写的文章</a>里，谁看完谁牛 X</p>
</li>
<li>
<p>JS 优化</p>
<p>使用 requestAnimationFrame 代替 setTimeout 或 setInterval</p>
</li>
<li>
<p>CSS 优化</p>
<p>使用 will-change 或 translate</p>
</li>
<li>
<p>没错</p>
<p>完全就是死记硬背</p>
</li>
</ul>
</li>
</ul>
<h2 id="3-transform">3. transform</h2>
<ul>
<li>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/transform">MDN 文档</a></p>
</li>
<li>
<p>四个常用功能</p>
<p>位移 translate</p>
<p>缩放 scale</p>
<p>旋转 rotate</p>
<p>倾斜 skew</p>
</li>
<li>
<p>经验</p>
<p>一般都需要配合 transition 过渡</p>
<p>inline 元素不支持 transform，需要先变成 block</p>
</li>
<li>
<p>transform 之 translate</p>
<ul>
<li>
<p>常用写法</p>
<p>translateX( &lt;length-percentage&gt; )</p>
<p>translateY( &lt;length-percentage&gt; )</p>
<p>translate( &lt;length-percentage&gt; , &lt;length-percentage&gt;? )</p>
<p>translateZ( &lt;length&gt; ) 且父容器 perspective</p>
<p>translate3d(x, y, z)</p>
<p><a href="http://js.jirengu.com/xidiy/1/edit?html,css,output">示例</a></p>
</li>
<li>
<p>经验</p>
<p>要学会看懂 MDN 的语法示例</p>
<p>translate(-50%,-50%) 可做绝对定位元素的居中</p>
</li>
</ul>
</li>
<li>
<p>transform 之 scale</p>
<ul>
<li>
<p>常用写法</p>
<p>scaleX( &lt;number&gt; )</p>
<p>scaleY( &lt;number&gt; )</p>
<p>scale( &lt;number&gt; , &lt;number&gt;? )</p>
<p><a href="http://js.jirengu.com/jucal/1/edit?html,css,output">示例</a></p>
</li>
<li>
<p>经验</p>
<p>用的较少，因为容易出现模糊</p>
</li>
</ul>
</li>
<li>
<p>transform 之 rotate</p>
<ul>
<li>
<p>常用写法</p>
<p>rotate( [ &lt;angle&gt; | &lt;zero&gt; ] )</p>
<p>rotateZ( [ &lt;angle&gt; | &lt;zero&gt; ] )</p>
<p>rotateX( [ &lt;angle&gt; | &lt;zero&gt; ] )</p>
<p>rotateY( [ &lt;angle&gt; | &lt;zero&gt; ] )</p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/transform-function/rotate3d">rotate3d</a> 太复杂，无法用语言表述</p>
<p><a href="http://js.jirengu.com/jiquq/1/edit?html,css,output">示例</a></p>
</li>
<li>
<p>经验</p>
<p>一般用于 360 度旋转制作 loading</p>
<p>用到时再搜索 rotate MDN 看文档</p>
</li>
</ul>
</li>
<li>
<p>transform 之 skew</p>
<ul>
<li>
<p>常用写法</p>
<p>skewX( [ &lt;angle&gt; | &lt;zero&gt; ] )</p>
<p>skewY( [ &lt;angle&gt; | &lt;zero&gt; ] )</p>
<p>skew( [ &lt;angle&gt; | &lt;zero&gt; ] , [ &lt;angle&gt; | &lt;zero&gt; ]? )</p>
<p><a href="http://js.jirengu.com/tazer/1/edit?html,css,output">示例</a></p>
</li>
<li>
<p>经验</p>
<p>用的较少</p>
<p>用到时再搜 skew MDN 文档</p>
</li>
</ul>
</li>
<li>
<p>transform 多重效果</p>
<ul>
<li>
<p>组合使用</p>
<p><code>transform: scale(0.5) translate(-100%, -100%);</code></p>
<p><code>transform: none;</code> 取消所有</p>
</li>
</ul>
</li>
</ul>
<h2 id="4-transition">4. transition</h2>
<ul>
<li>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/transform">MDN 文档</a></p>
</li>
<li>
<p>作用</p>
<p>补充中间帧</p>
</li>
<li>
<p>语法</p>
<p>transition: 属性名 时长 过渡方式 延迟</p>
<p><code>transition: left 200ms linear</code></p>
<p>可以用逗号分隔两个不同属性</p>
<p><code>transition: left 200ms, top 400ms</code></p>
<p>可以用 all 代表所有属性</p>
<p><code>transition: all 200ms</code></p>
<p>过渡方式有：linear | ease | ease-in | ease-out | ease-in-out | cubic-bezier | step-start | step-end | steps，<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/timing-function">具体含义</a>要靠数学知识</p>
</li>
<li>
<p>注意</p>
<ul>
<li>
<p>并不是所有属性都能过渡</p>
<p>display: none =&gt; block 没法过渡</p>
<p>一般改成 visibility: hidden =&gt; visible（没有为什么）</p>
<p>background 颜色可以过渡吗？（可以）</p>
<p>opacity 透明度可以过渡吗？（可以）</p>
</li>
<li>
<p>让一个盒子消失的三种过渡方案对比，均设置为<code>transition: all 5s;</code></p>
<p>A. 由 <code>display: block</code> 过渡为 <code>display: none</code></p>
<p>​	结果：盒子会在第一秒就立即消失，没有过渡效果，消失后不占位置</p>
<p>B. 由 <code>visibility: visible</code> 过渡为 <code>visibility: hidden</code></p>
<p>​	结果：盒子会在最后一秒立即消失，没有过渡效果，消失后继续占位置</p>
<p>C. 由 <code>opacity: 1</code> 过渡为 <code>opacity: 0</code></p>
<p>​	结果：盒子会慢慢变透明最终消失，有过渡效果，消失后继续占位置</p>
</li>
</ul>
</li>
<li>
<p>过渡必须要有起始，如果除了起始，还有中间点，怎么办？</p>
<p>两种办法</p>
<ul>
<li>
<p>使用两次 transform</p>
<p>.a === transform ===&gt; .b</p>
<p>.b === transform ===&gt; .c</p>
<p>如何知道到了中间点呢？</p>
<p>用 setTimeout 或者监听 transitionend 事件</p>
<p><a href="http://js.jirengu.com/buwah/1/edit?html,css,js,output">示例</a></p>
</li>
<li>
<p>使用 animation</p>
<p>声明关键帧</p>
<p>添加动画</p>
<p><a href="http://js.jirengu.com/peran/1/edit?html,css,output">示例</a></p>
</li>
</ul>
</li>
</ul>
<h2 id="5-animation">5. animation</h2>
<ul>
<li>
<p>@keyframes 完整语法</p>
<ul>
<li>
<p>标准写法</p>
<p>搜索 <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@keyframes">keyframes MDN</a> 讲的很清楚</p>
<p>一种写法是 from to</p>
<p>另一种写法是百分数</p>
</li>
</ul>
</li>
<li>
<p>如何让动画停在最后一帧</p>
<p>搜索 css animation stop at end</p>
<p><a href="https://stackoverflow.com/questions/12991164/maintaining-the-final-state-at-end-of-a-css3-animation/12991203#12991203">网友给出的答案</a>是加个 forwards</p>
<p><a href="http://js.jirengu.com/lodoy/1/edit?html,css,output">示例</a></p>
</li>
<li>
<p>缩写语法</p>
<p>animation: 时长 | 过渡方式 | 延迟 | 次数 | 方向 | 填充模式 | 是否暂停 | 动画名；</p>
<p>时长：1s 或者 1000ms</p>
<p>过渡方式：跟 transition 取值一样，如 linear</p>
<p>次数：3 或者 2.4 或者 infinite</p>
<p>方向：reverse | alternate | alternate-reverse</p>
<p>填充模式：none | forwards | backwards | both</p>
<p>是否暂停：paused | running</p>
<p>以上所有属性都有对应的单独属性</p>
</li>
</ul>

  </div>
  <footer>
  <p>
  &copy; 2020 董帅志.
  Powered by <a href="https://gohugo.io/">Hugo</a>
  using the <a href="https://github.com/koirand/pulp/">pulp</a> theme.
  </p>
</footer>


  </body>
</html>
