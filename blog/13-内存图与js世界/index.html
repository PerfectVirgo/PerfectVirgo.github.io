<!DOCTYPE html>
<html>
  <head>
  <title>
      
          内存图与JS世界 - 董帅志的小窝
      
  </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="董帅志" />
  <link rel="shortcut icon" type="image/x-icon" href="https://example.org/img/favicon.ico">

  
  
  
  
  
  <link rel="stylesheet" href="https://example.org/style.min.6f642c5866835106e8a19b94463576436c99be9e41a8714ab3df3daa95f6bf90.css" integrity="sha256-b2QsWGaDUQbooZuURjV2Q2yZvp5BqHFKs989qpX2v5A=">
  
  
  
  <link rel="stylesheet" href="https://example.org/style-dark.min.0a647fb6c07e04b77b54fa0515d0a683d39ecdb251dba960fe1f966f7ff36fc2.css" media="(prefers-color-scheme: dark)" integrity="sha256-CmR/tsB&#43;BLd7VPoFFdCmg9OezbJR26lg/h&#43;Wb3/zb8I=">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

  
  

  <meta property="og:title" content="内存图与JS世界" />
<meta property="og:description" content="1. 操作系统常识 一切都运行在内存里 开机 操作系统在 C 盘里（macOS 的在根目录下多个目录里） 当你按下开机键，主板通电，开始读取固件 固件就是固定在" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://example.org/blog/13-%E5%86%85%E5%AD%98%E5%9B%BE%E4%B8%8Ejs%E4%B8%96%E7%95%8C/" />
<meta property="article:published_time" content="2020-04-08T01:37:57+08:00" />
<meta property="article:modified_time" content="2020-04-08T01:37:57+08:00" />
<meta itemprop="name" content="内存图与JS世界">
<meta itemprop="description" content="1. 操作系统常识 一切都运行在内存里 开机 操作系统在 C 盘里（macOS 的在根目录下多个目录里） 当你按下开机键，主板通电，开始读取固件 固件就是固定在">
<meta itemprop="datePublished" content="2020-04-08T01:37:57&#43;08:00" />
<meta itemprop="dateModified" content="2020-04-08T01:37:57&#43;08:00" />
<meta itemprop="wordCount" content="2175">



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:image" content="https://example.org//img/avatar.jpg"/>
<meta name="twitter:title" content="内存图与JS世界"/>
<meta name="twitter:description" content="1. 操作系统常识 一切都运行在内存里 开机 操作系统在 C 盘里（macOS 的在根目录下多个目录里） 当你按下开机键，主板通电，开始读取固件 固件就是固定在"/>

  <!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
  <![endif]-->

  <!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
  <![endif]-->

  </head>

  <body>
    
  <h1>内存图与JS世界</h1>
  <header>
  
  <div class="avatar">
    <img class="avatarMask" src="https://example.org//img/avatar.jpg" alt="">
    <a href="https://example.org/"><img class="avatar-border" src="https://example.org//img/avatar-border.svg" alt=""></a>
  </div>
  
  <h2><a class="author" href="https://example.org/">董帅志</a></h2>
</header>

  
  
  
  <p class="date">April 8, 2020</p>
  
  
  
  
  <div id="contentBody">
    <h2 id="1-操作系统常识">1. 操作系统常识</h2>
<ul>
<li>
<p>一切都运行在内存里</p>
<ul>
<li>
<p>开机</p>
<p>操作系统在 C 盘里（macOS 的在根目录下多个目录里）</p>
<p>当你按下开机键，主板通电，开始读取固件</p>
<p>固件就是固定在主板上的存储设备，里面有开机程序</p>
<p>开机程序会将文件里的<strong>操作系统</strong>加载到内存中运行</p>
</li>
<li>
<p>操作系统（以 Linux 为例）</p>
<p>首先加载操作系统内核</p>
<p>然后启动初始化进程，编号为1，每个进程都有编号</p>
<p>启动系统服务：文件、安全、联网</p>
<p>等待用户登录：输入密码登录 / ssh 登录</p>
<p>登录后，运行 shell，用户就可以和操作系统对话了</p>
<p>bash 是一种 shell，图形化界面可认为是一种 shell</p>
</li>
</ul>
</li>
<li>
<p>打开浏览器</p>
<ul>
<li>
<p>chrome.exe</p>
<p>你双击 Chrome 图标，就会运行 chrome.exe 文件</p>
<p>开启 Chrome 进程，作为主进程</p>
<p>主进程会开启一些辅助进程，如网络服务、GPU 加速</p>
<p>你每新建一个网页，就有<strong>可能</strong>会开启一个子进程</p>
</li>
<li>
<p>浏览器的功能</p>
<p>发起请求，<strong>下载</strong> HTML，<strong>解析</strong> HTML，<strong>下载</strong> CSS，<strong>解析</strong> CSS，<strong>渲染</strong>界面，<strong>下载</strong> JS，<strong>解析</strong> JS，<strong>执行</strong> JS 等</p>
<p>功能模块：用户界面、<strong>渲染引擎</strong>、<strong>JS 引擎</strong>、存储等</p>
<p>上面功能模块一般各处于不同的<strong>线程</strong>（比进程更小）</p>
<p><img src="https://i.loli.net/2020/04/08/fpw3JriyFu7x1Lj.png" alt="线程.PNG"></p>
<p>如果进程是车间，那么线程就是车间的流水线</p>
</li>
</ul>
</li>
<li>
<p>JS 引擎</p>
<ul>
<li>
<p>JS 引擎举例</p>
<p>Chrome 用的是 V8 引擎，C++ 编写</p>
<p>网景用的是 SpiderMonkey，后被 Firefox 使用，C++</p>
<p>Safari 用的是 JavaScriptCore</p>
<p>IE 用的是 Chakra（JScript9）</p>
<p>Edge 用的是 Chakra（JavaScript）</p>
<p>Node.js 用的是 V8 引擎</p>
</li>
<li>
<p>主要功能</p>
<p>编译：把 JS 代码翻译为机器能执行的字节码或机器码</p>
<p>优化：改写代码，使其更高效</p>
<p>执行：执行上面的字节码或者机器码</p>
<p>垃圾回收：把 JS 用完的内存回收，方便之后再次使用</p>
</li>
</ul>
</li>
<li>
<p>执行 JS 代码</p>
<ul>
<li>
<p>准备工作</p>
<p>提供 API：window / document / setTimeout</p>
<p>没错，上面这些东西都不是 JS 自身具备的功能，是浏览器的功能</p>
<p>我们将这些功能称为运行环境 runtime env</p>
<p>一旦把 JS 放进页面，就开始执行 JS</p>
</li>
<li>
<p>等一下</p>
<p>JS 代码在哪里运行？</p>
<p>答：内存</p>
<p>哪里的内存？</p>
<p>答：如下</p>
</li>
</ul>
</li>
</ul>
<h2 id="2-内存图">2. 内存图</h2>
<ul>
<li>
<p>瓜分内存</p>
<p><img src="https://i.loli.net/2020/04/08/vCi3DRjngzM69tO.png" alt="瓜分内存.png"></p>
</li>
<li>
<p>红色区域</p>
<ul>
<li>
<p>作用</p>
<p>红色专门用来存放数据，我们目前只研究该区域</p>
<p>红色区域并不存变量名，变量名在【不知什么区】</p>
<p>每种浏览器的分配规则并不一样</p>
<p>上图的区域并不完整</p>
<p>我还没有画【调用栈】、【任务队列】等区域</p>
</li>
<li>
<p>Stack 和 Heap</p>
<p>红色区域分为 Stack 栈和 Heap 堆</p>
<p>要解释为什么叫栈和堆需要数据结构知识，后面再讲</p>
<p>Stack 区特点：每个数据顺序存放</p>
<p>Heap 区特点：每个数据随机存放</p>
</li>
</ul>
</li>
<li>
<p>Stack 和 Heap 举例</p>
<ul>
<li>
<p>代码</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">b</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">a</span>
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">person</span> <span style="color:#f92672">=</span> {<span style="color:#a6e22e">name</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#39;frank&#39;</span>,<span style="color:#a6e22e">child</span><span style="color:#f92672">:</span>{<span style="color:#a6e22e">name</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#39;jack&#39;</span>}}
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">person2</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">person</span>
</code></pre></div></li>
<li>
<p>图示</p>
<p><img src="https://i.loli.net/2020/04/08/N7lo6jZHXC4zLYD.png" alt="StackHeap存储.PNG"></p>
</li>
<li>
<p>规律</p>
<p>数据分两种：非对象和对象</p>
<p>非对象都存在 Stack（只有数字、字符串、布尔是非对象）</p>
<p>对象都存在 Heap（数组、函数等）</p>
<p>= 号总是会把右边的东西复制到左边（不存在什么传值和传址）</p>
<p>区分值和地址（不会画内存图的人才需要做这件事）</p>
</li>
<li>
<p>对象被篡改了</p>
<p>代码</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">person</span> <span style="color:#f92672">=</span> {<span style="color:#a6e22e">name</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#39;frank&#39;</span>};
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">person2</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">person</span>;
<span style="color:#a6e22e">p2</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ryan&#39;</span>;
<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">name</span>);  <span style="color:#75715e">//&#39;ryan&#39;
</span></code></pre></div></li>
</ul>
</li>
</ul>
<h2 id="3-js-世界">3. JS 世界</h2>
<ul>
<li>
<p>盘古开天辟地之前，神说要有光，就有了光</p>
<p>JS 开发者说要有 window，就有了 window（浏览器提供）</p>
</li>
<li>
<p>还要什么</p>
<ul>
<li>
<p>要有 console</p>
<p>于是就有了 console，并且挂到 window 上</p>
</li>
<li>
<p>要有 document</p>
<p>于是就有了 document，并且挂到 window 上</p>
</li>
<li>
<p>要有对象</p>
<p>于是就有了 Object，并且挂到 window 上</p>
<p><code>var person = {}</code> 等价于 <code>var person = new Object()</code></p>
</li>
<li>
<p>要有数组（一种特殊的对象）</p>
<p>于是就有了 Array，并且挂到 window 上</p>
<p><code>var a = [1,2,3]</code> 等价于 <code>var a = new Array(1,2,3)</code></p>
</li>
<li>
<p>要有函数（一种特殊的对象）</p>
<p>于是就有了 Function，并且挂到 window 上</p>
<p><code>function f(){}</code> 等价于 <code>var f = new Function()</code></p>
</li>
</ul>
<p><img src="https://i.loli.net/2020/04/08/tqhk7gIxzaeNnwP.png" alt="挂window上.png"></p>
</li>
<li>
<p>题外话</p>
<p>Q：为什么有 <code>var a = []</code>，还要提供 <code>var a = new Array()</code> 写法呢？</p>
<p>A：因为后者是正规写法，但是没人用。前者不正规，但是好用啊。</p>
<p>Q：为什么有 <code>function f(){}</code>，还要提供 <code>var f = new Function</code> 写法呢？</p>
<p>A：原因同上</p>
</li>
<li>
<p>怎么什么都挂在 window 上</p>
<p>因为方便，挂在 window 上的东西可以在任何地方<strong>直接</strong>用</p>
<p>把 window 用内存图画出来</p>
<p><img src="https://i.loli.net/2020/04/08/edbG1XSRxaZYFQs.png" alt="window用内存图画.png"></p>
<p>更简单的画法</p>
<p><img src="https://i.loli.net/2020/04/08/bRatK61UPIQG2S3.png" alt="window用内存图更简单画法.png"></p>
</li>
<li>
<p>细节</p>
<ul>
<li>
<p>关于 window</p>
<p>window 变量和 window 对象是两个东西</p>
<p>window 变量是一个容器，恰好存放了 window 对象的地址</p>
<p>window 对象是 Heap 里的一坨数据</p>
<p>不信的话，可以让 <code>var x = window</code>，那么这个 x 就指向了 window 对象，window 变量可以去死了</p>
<p>但是这样的代码会弄晕新手，所以不要这样写</p>
</li>
<li>
<p>同理</p>
<p>console 和 console 对象不是同一个东西</p>
<p>Object 和 Object 函数对象不是同一个东西</p>
<p>前者是内存地址，后者是一坨内存</p>
</li>
<li>
<p>一般来说，如果第一个字母是大写的，那它就会有 prototype 属性</p>
</li>
<li>
<p>用一个特殊的API：console.dir()可以打出括号内的结构，例如：</p>
<p><img src="https://i.loli.net/2020/04/08/zZnwlDNBPOtYeuV.png" alt="consoledir打出结构.png"></p>
</li>
</ul>
</li>
<li>
<p>JS 三座大山</p>
<p>1.this</p>
<p>2.原型</p>
<p>3.AJAX</p>
</li>
</ul>
<h2 id="4-原型链">4. 原型链</h2>
<ul>
<li>
<p>图里的 prototype 是干什么用的</p>
</li>
<li>
<p>打印出来看看</p>
<p>console.dir(window.Object.prototype)，当然，window. 可以省略</p>
<p>看起来就是一些无用的函数，毫无用处啊</p>
</li>
<li>
<p>思考一个问题</p>
<ul>
<li>
<p>代码</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> {}
<span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">toString</span>()
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">arr</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>]
<span style="color:#a6e22e">arr</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;-&#39;</span>)
</code></pre></div><p>为什么不报错？为什么可以运行？</p>
</li>
<li>
<p>画图解释</p>
<p><img src="https://i.loli.net/2020/04/08/saODNHc42TXm1J3.png" alt="JS的光.png"></p>
<p>obj 有一个隐藏属性（暂定为 fuck）</p>
<p>隐藏属性存储了 Object.prototype 对象的地址</p>
<p>obj.toString() 发现 obj 上没有 toString</p>
<p>就去隐藏属性对应的对象里面找</p>
<p>于是就找到了 Object.prototype.toString</p>
<p>arr 同理</p>
</li>
</ul>
</li>
<li>
<p>再思考一个问题</p>
<ul>
<li>
<p>代码</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> {}
<span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">toString</span>()
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">obj2</span> <span style="color:#f92672">=</span> {}
<span style="color:#a6e22e">obj2</span>.<span style="color:#a6e22e">toString</span>()
</code></pre></div><p>obj 和 obj2 有什么联系？</p>
</li>
<li>
<p>画图解释（对象被篡改了）</p>
<p><img src="https://i.loli.net/2020/04/08/GoTQKupxNm8DILl.png" alt="对象被篡改之两层.PNG"></p>
<p>结论：一层是可以篡改的，两层是没有简单的办法篡改的，除非通过隐藏属性 fuck 来篡改</p>
</li>
<li>
<p>相同点</p>
<p>都可以调用 .toString()</p>
</li>
<li>
<p>不同点</p>
<p>地址不同 obj !== obj2</p>
<p>可以拥有不同的属性</p>
</li>
</ul>
</li>
<li>
<p>XXX.prototype 存储了 XXX 对象的共同属性</p>
<p>这就是原型</p>
</li>
<li>
<p>这有什么好处</p>
<p>如果没有原型会怎样</p>
</li>
<li>
<p>如果没有原型</p>
<ul>
<li>
<p>声明一个对象</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> {
    <span style="color:#a6e22e">toString</span><span style="color:#f92672">:</span> window.Object.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">toString</span>,
    <span style="color:#a6e22e">hasOwnPropertyOf</span><span style="color:#f92672">:</span> window.Object......
}
<span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">toString</span>()
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">obj2</span> <span style="color:#f92672">=</span> {
    <span style="color:#a6e22e">toString</span><span style="color:#f92672">:</span> window.Object.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">toString</span>,
    <span style="color:#a6e22e">hasOwnPropertyOf</span><span style="color:#f92672">:</span> window.Object......
}
<span style="color:#a6e22e">obj2</span>.<span style="color:#a6e22e">toString</span>()
</code></pre></div></li>
<li>
<p>你是不是想累死自己</p>
<p>好让我帮你还你的蚂蚁花呗</p>
</li>
</ul>
</li>
<li>
<p>原型让你无需重复声明共有属性</p>
<p>省代码，省内存</p>
</li>
<li>
<p>每个对象都有一个隐藏属性</p>
<p>指向原型（对象）</p>
</li>
<li>
<p><strong>我们只关心小写对象的隐藏属性，不关心首字母大写对象的隐藏属性</strong></p>
</li>
<li>
<p>如果没有这个隐藏属性</p>
<p>那 obj 特么怎么知道自己的共有属性在哪</p>
</li>
<li>
<p>这个隐藏属性叫什么</p>
<p>__proto__</p>
</li>
<li>
<p>prototype 和 __proto__ 区别是什么</p>
<p>都存着原型的地址</p>
<p>只不过 prototype 挂在函数上</p>
<p>__proto__ 挂在每个新生成的对象上</p>
</li>
<li>
<p>思考最后一个问题</p>
<ul>
<li>
<p>代码</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">arr</span>.<span style="color:#a6e22e">hasOwnPropertyOf</span>()
</code></pre></div><p>如果调用之，该去哪里找呢？</p>
</li>
<li>
<p>画图解释</p>
<p><img src="https://i.loli.net/2020/04/08/Xfq61Y7axdsktzB.png" alt="arrhasOwnPropertyOf.PNG"></p>
</li>
</ul>
</li>
</ul>
<p>​</p>

  </div>
  <footer>
  <p>
  &copy; 2020 董帅志.
  Powered by <a href="https://gohugo.io/">Hugo</a>
  using the <a href="https://github.com/koirand/pulp/">pulp</a> theme.
  </p>
</footer>


  </body>
</html>
